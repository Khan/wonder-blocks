import {Meta, Story, Source, Canvas} from "@storybook/addon-docs";

import {Body, HeadingSmall} from "@khanacademy/wonder-blocks-typography";
import {View} from "@khanacademy/wonder-blocks-core";
import Button from "@khanacademy/wonder-blocks-button";

import {SchedulePolicy} from "../util/policies.js";
import {useTimeout} from "./use-timeout.js";

<Meta title="Timing/useTimeout" />

# `useTimeout`

`useTimeout` is a hook that provides a convenient API for setting and clearing
a timeout.  It is defined as follows:

```
function useTimeout(
    action: () => mixed,
    timeoutMs: number,
    options?: {|
        schedulePolicy?: "schedule-immediately" | "schedule-on-demand",
        clearPolicy?: "resolve-on-clear" | "cancel-on-clear",
    |},
): ITimeout;

interface ITimeout {
    get isSet(): boolean;
    set(): void;
    clear(policy?: ClearPolicy): void;
}
```

By default the timeout will be set immediately up creation.  The `options` parameter can
be used to control when when the timeout is schedule and whether or not `action` should be
called when the timeout is cleared.

Notes:
- Calling `set` after the timeout has expired will restart the timeout.
- Updating the second paramter, `timeoutMs`, will also restart the timeout.
- When the component using this hooks is unmounted, the timeout will automatically be cleared.

export const Immediately = () => {
    const [callCount, setCallCount] = React.useState(0);
    const callback = React.useCallback(() => {
        setCallCount((callCount) => callCount + 1);
    }, []);
    const {isSet, set, clear} = useTimeout(callback, 1000);
    return (
        <View>
            <View>isSet = {isSet.toString()}</View>
            <View>callCount = {callCount}</View>
            <View style={{flexDirection: "row"}}>
                <Button onClick={set}>Set timeout</Button>
                <Button onClick={clear}>Clear timeout</Button>
            </View>
        </View>
    );
};

<Canvas>
    <Story name="Immediately">
        <Immediately />
    </Story>
</Canvas>

```
const Immediately = () => {
    const [callCount, setCallCount] = React.useState(0);
    const callback = React.useCallback(() => {
        setCallCount((callCount) => callCount + 1);
    }, []);
    const {isSet, set, clear} = useTimeout(callback, 1000);
    return (
        <View>
            <View>isSet = {isSet.toString()}</View>
            <View>callCount = {callCount}</View>
            <View style={{flexDirection: "row"}}>
                <Button onClick={set}>Set timeout</Button>
                <Button onClick={clear}>Clear timeout</Button>
            </View>
        </View>
    );
};
```

export const OnDemand = () => {
    const [callCount, setCallCount] = React.useState(0);
    const callback = React.useCallback(() => {
        setCallCount((callCount) => callCount + 1);
    }, []);
    const {isSet, set, clear} = useTimeout(
        callback,
        1000,
        SchedulePolicy.OnDemand,
    );
    return (
        <View>
            <View>isSet = {isSet.toString()}</View>
            <View>callCount = {callCount}</View>
            <View style={{flexDirection: "row"}}>
                <Button onClick={set}>Set timeout</Button>
                <Button onClick={clear}>Clear timeout</Button>
            </View>
        </View>
    );
};

<Canvas>
    <Story name="OnDemand">
        <OnDemand />
    </Story>
</Canvas>

```
const OnDemand = () => {
    const [callCount, setCallCount] = React.useState(0);
    const callback = React.useCallback(() => {
        setCallCount((callCount) => callCount + 1);
    }, []);
    const {isSet, set, clear} = useTimeout(
        callback,
        1000,
        SchedulePolicy.OnDemand,
    );
    return (
        <View>
            <View>isSet = {isSet.toString()}</View>
            <View>callCount = {callCount}</View>
            <View style={{flexDirection: "row"}}>
                <Button onClick={set}>Set timeout</Button>
                <Button onClick={clear}>Clear timeout</Button>
            </View>
        </View>
    );
};
```