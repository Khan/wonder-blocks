{"version":3,"file":"use-unique-id.stories-552e3033.js","sources":["../../packages/wonder-blocks-core/src/hooks/use-unique-id.ts","../../__docs__/wonder-blocks-core/use-unique-id.stories.mdx"],"sourcesContent":["import {useRef} from \"react\";\n\nimport {useRenderState} from \"./use-render-state\";\nimport SsrIDFactory from \"../util/ssr-id-factory\";\nimport UniqueIDFactory from \"../util/unique-id-factory\";\n\nimport {RenderState} from \"../components/render-state-context\";\n\nimport type {IIdentifierFactory} from \"../util/types\";\n\n/**\n * Returns a unique identifier factory.  If the parent component hasn't\n * been mounted yet, the global SsrIDFactory will be returned until the\n * component becomes mounted.\n *\n * @param {string} [scope] optional string to prefix generated ids with.\n * @returns {IIdentifierFactory}\n */\nexport const useUniqueIdWithMock = (scope?: string): IIdentifierFactory => {\n    const renderState = useRenderState();\n    const idFactory = useRef<IIdentifierFactory | null | undefined>(null);\n\n    if (renderState === RenderState.Root) {\n        throw new Error(\n            \"Components using useUniqueIdWithMock() should be descendants of <RenderStateRoot>\",\n        );\n    }\n\n    if (renderState === RenderState.Initial) {\n        return SsrIDFactory;\n    }\n\n    if (!idFactory.current) {\n        idFactory.current = new UniqueIDFactory(scope);\n    }\n\n    return idFactory.current;\n};\n\n/**\n * Returns a unique identifier factory.  If the parent component hasn't\n * been mounted yet, null will be returned.\n *\n * @param {string} [scope] optional string to prefix generated ids with.\n * @returns {?IIdentifierFactory}\n */\nexport const useUniqueIdWithoutMock = (\n    scope?: string,\n): IIdentifierFactory | null | undefined => {\n    const renderState = useRenderState();\n    const idFactory = useRef<IIdentifierFactory | null | undefined>(null);\n\n    if (renderState === RenderState.Root) {\n        throw new Error(\n            \"Components using useUniqueIdWithoutMock() should be descendants of <RenderStateRoot>\",\n        );\n    }\n\n    if (renderState === RenderState.Initial) {\n        return null;\n    }\n\n    if (!idFactory.current) {\n        idFactory.current = new UniqueIDFactory(scope);\n    }\n\n    return idFactory.current;\n};\n","import {Meta, Story, Canvas} from \"@storybook/blocks\";\n\nimport {Body, HeadingSmall} from \"@khanacademy/wonder-blocks-typography\";\nimport {\n    View,\n    useUniqueIdWithoutMock,\n    useUniqueIdWithMock,\n    RenderStateRoot,\n} from \"@khanacademy/wonder-blocks-core\";\nimport Button from \"@khanacademy/wonder-blocks-button\";\n\n<Meta\n    title=\"Core/useUniqueId*\"\n    parameters={{\n        chromatic: {\n            disableSnapshot: true,\n        },\n    }}\n/>\n\n# `useUniqueIdWithoutMock`\n\nThis hook is similar to `<UniqueIDProvider mockOnFirstRender={false}>`.\nIt will return `null` on the initial render and then the same identifier\nfactory for each subsequent render. The identifier factory is unique to\neach component.\n\nNOTE: All uses of `useUniqueIdWithoutMock` should appear as descendants\nof `<RenderStateRoot>`. It's customary to place `<RenderStateRoot>` near\nthe base of the render tree since only one instance is allow in any given\nrender tree.\n\nexport const WithoutMockExample = () => {\n    const [count, setCount] = React.useState(0);\n    const renders = React.useRef([]);\n    const ids = useUniqueIdWithoutMock();\n    const handleClick = () => {\n        setCount(count + 1);\n    };\n    if (ids) {\n        renders.current.push(ids.get(\"my-unique-id\"));\n    } else {\n        renders.current.push(\"null\");\n    }\n    return (\n        <View>\n            <Button onClick={handleClick} style={{width: 200}}>\n                Re-render\n            </Button>\n            <br />\n            renders:\n            {renders.current.map((value, index) => (\n                <View key={index}>\n                    Render {index}: {value}\n                </View>\n            ))}\n        </View>\n    );\n};\n\n<Canvas>\n    <Story name=\"WithoutMockExample\">\n        <RenderStateRoot>\n            <WithoutMockExample />\n        </RenderStateRoot>\n    </Story>\n</Canvas>\n\n# `useUniqueIdWithMock`\n\nThis hook is similar to `<UniqueIDProvider mockOnFirstRender={true}>`.\nIt will return a mock identifier factory on the initial render that doesn'that\nguarantee identifier uniqueness. Mock mode can help things appear on the screen\nduring the initial render, but is not the default, because it is not always safe\n(e.g., we need actual IDs for some SVG constructs).\n\nNOTE: All uses of `useUniqueIdWithMock` should appear as descendants\nof `<RenderStateRoot>`. It's customary to place `<RenderStateRoot>` near\nthe base of the render tree since only one instance is allow in any given\nrender tree.\n\nexport const WithMockExample = () => {\n    const [count, setCount] = React.useState(0);\n    const renders = React.useRef([]);\n    const ids = useUniqueIdWithMock();\n    const handleClick = () => {\n        setCount(count + 1);\n    };\n    if (ids) {\n        renders.current.push(ids.get(\"my-unique-id\"));\n    } else {\n        renders.current.push(\"null\");\n    }\n    return (\n        <View>\n            <Button onClick={handleClick} style={{width: 200}}>\n                Re-render\n            </Button>\n            <br />\n            renders:\n            {renders.current.map((value, index) => (\n                <View key={index}>\n                    Render {index}: {value}\n                </View>\n            ))}\n        </View>\n    );\n};\n\n<Canvas>\n    <Story name=\"WithMockExample\">\n        <RenderStateRoot>\n            <WithMockExample />\n        </RenderStateRoot>\n    </Story>\n</Canvas>\n\n# Scoped\n\nBoth of these hooks ensure that every identifier factory is unique using a\nunique number for each one. However, this isn't very readable when wanting to\ndifferentiate the types of things using unique identifiers. If we want to, we\ncan provide a `scope` param that adds some text to each identifier provided.\nThis can be useful for providing some quick at-a-glance component identification\nto identifiers when there are multiple hooks being used.\n\nexport const ScopedExample = () => {\n    const firstIdFactory = useUniqueIdWithoutMock(\"first\");\n    const secondIdFactory = useUniqueIdWithoutMock(\"second\");\n    return (\n        <View>\n            <HeadingSmall>First Provider with scope: first</HeadingSmall>\n            {firstIdFactory && (\n                <View>\n                    <Body>\n                        The id returned for my-identifier:{\" \"}\n                        {firstIdFactory.get(\"my-identifier\")}\n                    </Body>\n                </View>\n            )}\n            <HeadingSmall>Second Provider with scope: second</HeadingSmall>\n            {secondIdFactory && (\n                <View>\n                    <Body>\n                        The id returned for my-identifier:{\" \"}\n                        {secondIdFactory.get(\"my-identifier\")}\n                    </Body>\n                </View>\n            )}\n        </View>\n    );\n};\n\n<Canvas>\n    <Story name=\"ScopedExample\">\n        <RenderStateRoot>\n            <ScopedExample />\n        </RenderStateRoot>\n    </Story>\n</Canvas>\n"],"names":["useUniqueIdWithMock","scope","renderState","useRenderState","idFactory","useRef","RenderState","SsrIDFactory","UniqueIDFactory","useUniqueIdWithoutMock","WithoutMockExample","_components","_provideComponents","count","setCount","renders","ids","handleClick","_jsxs","View","_jsx","Button","value","index","WithMockExample","ScopedExample","firstIdFactory","secondIdFactory","HeadingSmall","Body","_createMdxContent","props","_Fragment","Meta","Canvas","Story","RenderStateRoot","MDXContent","MDXLayout","withoutMockExample","withMockExample","scopedExample","componentMeta","__namedExportsOrder"],"mappings":"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"}