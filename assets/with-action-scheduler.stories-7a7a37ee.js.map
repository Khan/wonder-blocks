{"version":3,"file":"with-action-scheduler.stories-7a7a37ee.js","sources":["../../__docs__/wonder-blocks-timing/with-action-scheduler-examples.tsx","../../__docs__/wonder-blocks-timing/with-action-scheduler.stories.mdx"],"sourcesContent":["import * as React from \"react\";\nimport Button from \"@khanacademy/wonder-blocks-button\";\nimport {View} from \"@khanacademy/wonder-blocks-core\";\nimport {withActionScheduler} from \"@khanacademy/wonder-blocks-timing\";\nimport type {WithActionSchedulerProps} from \"@khanacademy/wonder-blocks-timing\";\n\nexport const Unmounter = function (props: {\n    children: React.ReactNode;\n}): React.ReactElement {\n    const [mountKids, setMountKids] = React.useState(true);\n\n    const maybeRenderKids = () => {\n        if (!mountKids) {\n            return \"Children unmounted\";\n        }\n\n        return (\n            <>\n                <Button\n                    onClick={() => {\n                        setMountKids(false);\n                    }}\n                >\n                    Unmount\n                </Button>\n                {props.children}\n            </>\n        );\n    };\n\n    return <View>{maybeRenderKids()}</View>;\n};\n\nexport class MyNaughtyComponent extends React.Component<{\n    targetId: string;\n}> {\n    componentDidMount() {\n        const {targetId} = this.props;\n        let counter = 0;\n        const domElement: HTMLElement = document.getElementById(\n            targetId,\n        ) as any;\n\n        setInterval(() => {\n            domElement.innerText = \"Naughty interval logged: \" + counter++;\n        }, 200);\n    }\n\n    render(): React.ReactElement {\n        return <View>NaughtyComponent here</View>;\n    }\n}\n\ntype Props = WithActionSchedulerProps & {\n    targetId: string;\n};\n\nexport class MyGoodComponent extends React.Component<Props> {\n    componentDidMount() {\n        const {targetId, schedule} = this.props;\n        let counter = 0;\n        const domElement: HTMLElement = document.getElementById(\n            targetId,\n        ) as any;\n\n        schedule.interval(() => {\n            domElement.innerText = \"Naughty interval logged: \" + counter++;\n        }, 200);\n    }\n\n    render(): React.ReactElement {\n        return <View>GoodComponent here</View>;\n    }\n}\n\nexport const MyGoodComponentWithScheduler =\n    withActionScheduler(MyGoodComponent);\n","import {Meta, Story, Canvas} from \"@storybook/blocks\";\nimport {IDProvider, View} from \"@khanacademy/wonder-blocks-core\";\n\nimport packageConfig from \"../../packages/wonder-blocks-timing/package.json\";\n\nimport {\n    Unmounter,\n    MyGoodComponentWithScheduler,\n    MyNaughtyComponent,\n} from \"./with-action-scheduler-examples\";\nimport ComponentInfo from \"../../.storybook/components/component-info\";\n\n<Meta\n    title=\"Timing / withActionScheduler\"\n    parameters={{\n        previewTabs: {\n            canvas: {hidden: true},\n        },\n        viewMode: \"docs\",\n        chromatic: {\n            disableSnapshot: true,\n        },\n    }}\n    decorators={[(Story) => <View>{Story()}</View>]}\n/>\n\n# withActionSceduler\n\n<ComponentInfo name={packageConfig.name} version={packageConfig.version} />\n\nThis is a higher order component (HOC) that attaches the given component to an\n[`IScheduleActions`](#ischeduleactions) instance. Any actions scheduled will automatically be\ncleared on unmount. This allows for \"set it and forget it\" behavior that won't\nleave timers dangling when the component's lifecycle ends.\n\nFor more details on using this component and the [`IScheduleActions`](#ischeduleactions) interface,\nsee the [API overview](#timing-api-overview).\n\n## TypeScript Types\n\nIf you are using TypeScript typing, you can use the `WithActionSchedulerProps` type\nto build the props for the component that you will pass to the `withActionScheduler`\nfunction by spreading the type into your component's `Props` type.\n\nThe added `schedule` prop is of type [`IScheduleActions`](#ischeduleactions). This is what the\n`withActionScheduler` function injects to your component.\n\nThe returned value from `withActionScheduler` is a React component with props of\ntype `TProps`.\n\nAccess to the [timing API](/docs/timing-types-ischeduleactions--page) is provided via the `withActionScheduler` higher order\ncomponent.\n\n## Usage\n\n### Incorrect Usage\n\nThe following component, `MyNaughtyComponent`, will keep spamming our pretend\nlog even after it was unmounted.\n\nexport const IncorrectUsage = () => (\n    <IDProvider id=\"incorrect\">\n        {(id) => (\n            <View>\n                <Unmounter>\n                    <MyNaughtyComponent targetId={id} />\n                </Unmounter>\n                <View id={id} />\n            </View>\n        )}\n    </IDProvider>\n);\n\n<Canvas>\n    <Story name=\"IncorrectUsage\">\n        <IncorrectUsage />\n    </Story>\n</Canvas>\n\n```jsx\nfunction Unmounter(props: {|children: React.Node|}): React.Node {\n    const [mountKids, setMountKids] = React.useState(true);\n\n    const maybeRenderKids = () => {\n        if (!mountKids) {\n            return \"Children unmounted\";\n        }\n\n        return (\n            <>\n                <Button\n                    onClick={() => {\n                        setMountKids(false);\n                    }}\n                >\n                    Unmount\n                </Button>\n                {props.children}\n            </>\n        );\n    };\n\n    return <View>{maybeRenderKids()}</View>;\n}\n\nclass MyNaughtyComponent extends React.Component<{|targetId: string|}> {\n    componentDidMount() {\n        const {targetId} = this.props;\n        let counter = 0;\n        const domElement: HTMLElement = (document.getElementById(\n            targetId,\n        ): any);\n\n        setInterval(() => {\n            domElement.innerText = \"Naughty interval logged: \" + counter++;\n        }, 200);\n    }\n\n    render(): React.Node {\n        return <View>NaughtyComponent here</View>;\n    }\n}\n\nconst IncorrectUsage = () => (\n    <IDProvider id=\"incorrect\">\n        {(id) => (\n            <View>\n                <Unmounter>\n                    <MyNaughtyComponent targetId={id} />\n                </Unmounter>\n                <View id={id} />\n            </View>\n        )}\n    </IDProvider>\n);\n```\n\n### Correct Usage\n\nBut if we use `withActionScheduler` and the `interval` method, everything is\nfine. Unmount the component, and the logging stops.\n\nexport const CorrectUsage = () => (\n    <IDProvider id=\"correct\">\n        {(id) => (\n            <View>\n                <Unmounter>\n                    <MyGoodComponentWithScheduler targetId={id} />\n                </Unmounter>\n                <View id={id} />\n            </View>\n        )}\n    </IDProvider>\n);\n\n<Canvas>\n    <Story name=\"CorrectUsage\">\n        <CorrectUsage />\n    </Story>\n</Canvas>\n\n```jsx\nimport {withActionScheduler} from \"@khanacademy/wonder-blocks-timing\";\nimport type {\n    WithActionSchedulerProps,\n    WithoutActionScheduler,\n} from \"@khanacademy/wonder-blocks-timing\";\n\ntype Props = {|\n    ...WithActionSchedulerProps,\n    targetId: string,\n|};\n\nclass MyGoodComponent extends React.Component<Props> {\n    componentDidMount() {\n        const {targetId, schedule} = this.props;\n        let counter = 0;\n        const domElement: HTMLElement = (document.getElementById(\n            targetId,\n        ): any);\n\n        schedule.interval(() => {\n            domElement.innerText = \"Naughty interval logged: \" + counter++;\n        }, 200);\n    }\n\n    render(): React.Node {\n        return <View>GoodComponent here</View>;\n    }\n}\n\nconst MyGoodComponentWithScheduler: React.AbstractComponent<\n    WithoutActionScheduler<React.ElementConfig<typeof MyGoodComponent>>,\n    MyGoodComponent,\n> = withActionScheduler(MyGoodComponent);\n\n// This is the same as the previous example\nfunction Unmounter(props: {|children: React.Node|}): React.Node {\n    ...\n}\n\nconst CorrectUsage = () => (\n    <IDProvider id=\"correct\">\n        {(id) => (\n            <View>\n                <Unmounter>\n                    <MyGoodComponentWithScheduler targetId={id} />\n                </Unmounter>\n                <View id={id} />\n            </View>\n        )}\n    </IDProvider>\n);\n```\n"],"names":["Unmounter","props","mountKids","setMountKids","React.useState","jsx","View","jsxs","Fragment","Button","MyNaughtyComponent","React.Component","targetId","counter","domElement","MyGoodComponent","schedule","MyGoodComponentWithScheduler","withActionScheduler","IncorrectUsage","_jsx","IDProvider","id","_jsxs","CorrectUsage","_createMdxContent","_components","_provideComponents","_Fragment","Meta","Story","ComponentInfo","packageConfig","Canvas","MDXContent","MDXLayout","incorrectUsage","correctUsage","componentMeta","__namedExportsOrder"],"mappings":"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"}