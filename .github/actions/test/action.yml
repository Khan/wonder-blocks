name: 'Test'
description: 'Run testing checks'
runs:
  using: 'composite'
  steps:
    - uses: actions/checkout@v4
    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}

    - name: Install & cache node_modules
      uses: Khan/actions@shared-node-cache-v2
      with:
        node-version: ${{ matrix.node-version }}
    # Testing and coverage
    - name: Run jest tests with coverage
      shell: bash
      run: yarn coverage:ci --shard ${{ matrix.shard }}
    - name: Upload Coverage
      uses: codecov/codecov-action@v4
      with:
        token: ${{ env.CODECOV_TOKEN }}
        files: ./coverage/coverage-final.json
